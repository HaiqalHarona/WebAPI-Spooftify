<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Spooftify Playlist UI - IFrame Control</title>
    <!-- Load Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Load Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>
    <!-- Load the Spotify IFrame API Script -->
    <script src="https://open.spotify.com/embed/iframe-api/v1" async></script>
    <style>
        /* Custom styles for the Inter font and dark background */
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap');
        body {
            font-family: 'Inter', sans-serif;
            background-color: #0f172a; /* Slate 900 */
        }
        .scrollable-content {
            /* Account for the fixed bottom player bar (96px) */
            max-height: calc(100vh - 96px);
            overflow-y: auto;
            padding-bottom: 2rem;
        }
        /* Custom scrollbar for dark theme */
        .scrollable-content::-webkit-scrollbar { width: 8px; }
        .scrollable-content::-webkit-scrollbar-thumb { background: #334155; border-radius: 4px; }
        .scrollable-content::-webkit-scrollbar-track { background: #1e293b; }
    </style>
</head>
<body class="text-white min-h-screen">

    <!-- Main Content Area -->
    <div class="scrollable-content">
        <div class="max-w-4xl w-full mx-auto p-6 md:p-8">
            
            <!-- Playlist Header Section -->
            <header class="bg-zinc-800 p-6 rounded-xl shadow-lg mb-6">
                <div class="flex items-end space-x-6">
                    <!-- Album Image Placeholder -->
                    <img src="https://placehold.co/150x150/1Db954/000000?text=Sofy" onerror="this.src='https://placehold.co/150x150/1Db954/000000?text=Sofy';" alt="Playlist Art" class="w-24 h-24 md:w-40 md:h-40 rounded-lg shadow-xl">
                    
                    <div>
                        <p class="text-xs font-semibold uppercase text-white/70">Playlist</p>
                        <h1 class="text-3xl md:text-5xl font-extrabold text-white my-1">Top 5 Test Tracks</h1>
                        <p class="text-sm text-white/50">Spooftify | 5 tracks</p>
                    </div>
                </div>
            </header>

            <!-- Playback Button Row (Optional - will control the bottom player) -->
            <div class="flex items-center space-x-4 mb-6">
                <button id="main-play-btn" class="bg-green-500 hover:bg-green-400 text-black p-4 rounded-full shadow-lg transition duration-200">
                    <i data-lucide="play" class="w-6 h-6 fill-black"></i>
                </button>
                <button title="Follow" class="text-white/70 hover:text-white transition duration-200">
                    <i data-lucide="heart" class="w-6 h-6"></i>
                </button>
            </div>

            <!-- Playlist Track List Header -->
            <div class="grid grid-cols-12 text-slate-400 text-xs font-semibold uppercase tracking-wider border-b border-slate-700 pb-3 mb-3">
                <div class="col-span-1 text-center">#</div>
                <div class="col-span-6">Title</div>
                <div class="col-span-4 hidden sm:block">Artist / Album</div>
                <div class="col-span-1 text-right"><i data-lucide="clock" class="w-4 h-4 inline"></i></div>
            </div>

            <!-- Playlist Track Content -->
            <div id="playlist-container" class="space-y-1">
                <!-- Song rows will be generated here -->
            </div>
        </div>
    </div>
    
    <!-- Fixed Bottom Player Bar -->
    <div class="fixed bottom-0 left-0 right-0 h-24 bg-zinc-900 border-t border-zinc-700 flex items-center shadow-2xl p-2 md:px-4">
        <div class="w-full h-full" id="spotify-player-container">
            <!-- Spotify Iframe API will inject the player here -->
        </div>
    </div>

    <script type="text/javascript">
        
        // --- CONSTANTS AND DATA ---

        // The default track ID for initial load and all list items
        const DEFAULT_TRACK_ID = '2YZa0dsV3xXGZ61XFYiRt8'; 
        let embedController = null;

        // Data structure to create 5 identical placeholder songs
        const trackData = [
            { id: DEFAULT_TRACK_ID, name: "Sunset Drive", artist: "Cosmograph, LEVEL NINE", album: "Top Hits 2024", durationMs: 194594 },
            { id: DEFAULT_TRACK_ID, name: "City Lights", artist: "Aurora Bloom", album: "Neon Echoes", durationMs: 210123 },
            { id: DEFAULT_TRACK_ID, name: "Midnight Rain", artist: "The Synthetics", album: "Rainy Day Mixtape", durationMs: 185000 },
            { id: DEFAULT_TRACK_ID, name: "Electric Dream", artist: "Cosmograph", album: "Dreamscape", durationMs: 220000 },
            { id: DEFAULT_TRACK_ID, name: "Ocean Waves", artist: "LEVEL NINE", album: "Acoustic Retreat", durationMs: 170000 },
        ];
        
        // --- HELPER FUNCTIONS ---

        // Converts milliseconds to MM:SS format
        function formatDuration(ms) {
            const totalSeconds = Math.floor(ms / 1000);
            const minutes = Math.floor(totalSeconds / 60);
            const seconds = totalSeconds % 60;
            return `${minutes}:${seconds.toString().padStart(2, '0')}`;
        }
        
        /**
         * Loads a new track URI into the single, shared Spotify player.
         * @param {string} trackId - The Spotify track ID.
         */
        function loadNewTrack(trackId) {
            if (embedController) {
                const trackUri = `spotify:track:${trackId}`;
                embedController.loadUri(trackUri).then(() => {
                    console.log(`Loaded track: ${trackId}`);
                });
            } else {
                console.error("Player controller not yet initialized.");
            }
        }

        // --- UI RENDERING AND EVENTS ---

        function renderPlaylist() {
            const container = document.getElementById('playlist-container');
            if (!container) return; 

            container.innerHTML = trackData.map((track, index) => {
                const trackUri = `spotify:track:${track.id}`;
                // Escape single quotes in track.name for safety in JS call
                const escapedTrackName = track.name.replace(/'/g, "\\'"); 
                
                return `
                    <div 
                        data-uri="${trackUri}"
                        onclick="loadNewTrack('${track.id}')"
                        class="song-row grid grid-cols-12 items-center p-2 rounded-lg hover:bg-zinc-800 transition duration-150 cursor-pointer group"
                    >
                        <div class="col-span-1 text-sm font-medium text-slate-400 text-center relative">
                            <!-- Play button overlay -->
                            <span class="opacity-100 group-hover:opacity-0">${index + 1}</span>
                            <button title="Play" class="absolute inset-0 flex items-center justify-center opacity-0 group-hover:opacity-100 text-green-500">
                                <i data-lucide="play-circle" class="w-6 h-6 fill-green-500"></i>
                            </button>
                        </div>
                        
                        <div class="col-span-6 flex flex-col min-w-0 pr-4">
                            <p class="text-base font-medium truncate text-white">${track.name}</p>
                        </div>

                        <div class="col-span-4 hidden sm:block text-sm text-slate-400 truncate">
                            ${track.artist}
                            <span class="text-xs text-slate-500 hidden md:inline"> Â· ${track.album}</span>
                        </div>

                        <div class="col-span-1 text-sm text-slate-400 text-right">
                            ${formatDuration(track.durationMs)}
                        </div>
                    </div>
                `;
            }).join('');
            
            // Re-run Lucide icons after dynamic HTML injection
            lucide.createIcons();
        }

        // --- SPOTIFY IFRAME API INITIALIZATION ---
        
        window.onSpotifyIframeApiReady = (IFrameAPI) => {
            const element = document.getElementById('spotify-player-container');
            
            if (!element) {
                console.error("Error: Player container not found.");
                return;
            }

            // Options for the single, compact player in the bottom bar
            const options = {
                width: '100%',
                height: '96', // Height matches the parent container height
                uri: `spotify:track:${DEFAULT_TRACK_ID}` // Initial track
            };

            const callback = (Controller) => {
                // Store the controller globally so the loadNewTrack function can access it
                embedController = Controller; 
                console.log("Spotify Embed Controller initialized.");

                // Hook up the main play button to the controller
                document.getElementById('main-play-btn').onclick = () => {
                    Controller.togglePlay();
                };
            };
            
            IFrameAPI.createController(element, options, callback);
        };

        // Initialize UI components
        document.addEventListener('DOMContentLoaded', () => {
            renderPlaylist();
        });
    </script>
</body>
</html>

